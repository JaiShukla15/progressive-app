<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Pwa</title>
  <base href="/pwa-app">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1976d2">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <meta name="theme-color" content="#1976d2">
</head>
<body>
  <app-root></app-root>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js"></script>

 <script>
   const bgFetchButton = document.querySelector('#bgBtn');

   bgFetchButton.addEventListener('click', async event => {
    // Let's assume that we got some unique ID of the asset set we want to download
    let assetToFetchId = 'series';

    try {
      bgFetchButton.disabled = true;
      const registration = await navigator.serviceWorker.ready;

      // This could be an API call to our backend
      let assetsData = await assetsDataResponse.json();

      const bgFetchRegistration = await registration.backgroundFetch.fetch(
        'bg-fetch-02',
        'https://speed.hetzner.de/100MB.bin',
        {
          icons: assetsData.icons,
          title: `Downloading  file !!!!!`,
          downloadTotal: 90 * 1024 * 1024
        }
      );

      bgFetchRegistration.addEventListener('progress', event => {
        fetchProgress = event.currentTarget;
        progressStatus.innerHTML = `Progress: downloaded ${bytesToSize(
          fetchProgress.downloaded
        )}  from ${bytesToSize(fetchProgress.downloadTotal)} (${Math.round(
          (fetchProgress.downloaded * 100) / fetchProgress.downloadTotal
        )}%)`;

        if (fetchProgress.downloadTotal==fetchProgress.downloaded) {
          bgFetchButton.disabled = false;
        }
      });
    } catch (err) {
      alert(
        'Please enable downloads for this website (click the icon on the right side of the address bar)'
      );
      console.error(err);
    }
  });

  function bytesToSize(bytes, decimals) {
    if (bytes == 0) return '0 Bytes';
    var k = 1024,
      dm = decimals <= 0 ? 0 : decimals || 2,
      sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'],
      i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
  }

  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/service-worker.js');
    });
  }
  </script>
  <noscript>Please enable JavaScript to continue using this application.</noscript>
</body>
</html>
